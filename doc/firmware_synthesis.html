<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Magmio a.s." />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>Firmware synthesis - Magmio User's Manual</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link href="css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Firmware synthesis";
        var mkdocs_page_input_path = "firmware_synthesis.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]--> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="./index.html">
          <img src="img/magmio-slogan-logo.png" class="logo" alt="Logo"/>
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Magmio User Guide</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="exanic_tools.html">Exanic tools</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="api.html">API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="mapping_configuration.html">Mapping and configuration files</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="strategies.html">Writing strategies</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="hls_strategy_simulation.html">Testing strategies in Vivado HLS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="recovery.html">Recovery</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="book_channel.html">Book Channel</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="strategy_prefilter.html">Strategy Prefilter</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="riskcheck.html">PreTrade Risk Check</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="order_sender.html">Order Sender</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="status_channel.html">Status information</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="firmware_synthesis.html">Firmware synthesis</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#testing-the-firmware">Testing the firmware</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="model_verification.html">Software model, simulation and verification</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="about.html">About</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="./index.html">Magmio User's Manual</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><hr/>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="firmware-synthesis">Firmware synthesis</h1>
<p>First, C++ source file is compiled to VHDL/Verilog and then synthesized. Resulting bitstream (.bit) file contains the programming information for an FPGA. Loading of the resulting firmware to the FPGA card is done via the API by running the trading application (software).</p>
<p>Firmware has to be synthesized after every modification of strategy source files. To do so, run <code>make firmware</code> in your local copy of Magmio package specific strategy folder <code>strategies/&lt;strategy&gt;/src</code>:</p>
<pre><code>$ cd ~/my-local/strategies/happy_trigger/src
$ make firmware
</code></pre>
<p>This <code>make</code> call automatically checks a remote machine environment and sets it up or restores it if needed. If a non-empty remote directory is detected, a user is prompted and asked for permission to erase the existing remote directory if necessary. Then all files required for remote synthesis including customer strategy source files are copied to the remote synthesis machine and firmware synthesis starts afterwards. After the synthesis is done, firmware as well as strategy source files are downloaded back to development machine into paths:</p>
<pre><code>~/my-local/strategies/&lt;strategy&gt;/build/
~/my-local/strategies/&lt;strategy&gt;/src/
</code></pre>
<p>Firmware naming convention follows <code>&lt;strategy&gt;_&lt;build_number&gt;.bit</code> (<code>&lt;strategy&gt;_&lt;build_number&gt;.fw</code> for cisco cards) pattern, where <code>build_number</code> is a unique number identifying particular firmware build. It serves for version control during the process of loading firmware into the card.</p>
<p>Alternatively, you can run synthesis process by:</p>
<pre><code>$ make firmware_verbose
</code></pre>
<p>The build process is the same, only the logs are printed directly to the terminal. This approach is suitable for various debugging purposes.</p>
<p>If the card recognizes, that a firmware with exactly the same name and build number is already loaded in its flash memory, it just loads the firmware directly from the flash memory, which is itself a fast operation. However, if a different firmware version is detected (different name or build number), the firmware has to be loaded into the flash memory first. That case leads to longer boot time as the copying the firmware to the flash memory in the card takes significantly longer than loading existing firmware from card flash memory only. *<em>.bit</em> files are used during <a href="api.html#api-examples">initialization of Magmio application</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The synthesis is not deterministic, it is possible that the synthesis process will fail because of not meeting timing constraints. In such case, the synthesis is ran again automatically. Number of runs can be specified in the strategy Makefile.</p>
</div>
<p>It is possible to check latency and resource consumption of your strategies before firmware synthesis by following command:</p>
<pre><code>$ make check_latency
</code></pre>
<p>It is possible to run several syntheses in parallel. Every synthesis is done in a separate temporary directory. Firmware can be distinguished by the name and corresponding strategy source file.</p>
<h2 id="testing-the-firmware">Testing the firmware</h2>
<p>When the synthesis of the firmware is done, use Magmio API for Magmio platform initialization. To be able to receive data from the exchange, it is necessary to properly configure packet filter rules in <a href="mapping_configuration.html">the configuration file</a>. After invoking <code>run()</code> method from Magmio API, multicast groups are automatically subscribed.</p>
<p>Magmio API provides methods for reading outputs from Decoder, Enhanced Top of Book and Strategy Engine. <a href="api.html">Example</a> of using these methods is included in Magmio package. These outputs can be <a href="model_verification.html#offline-verification">compared with software model</a>.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="status_channel.html" class="btn btn-neutral float-left" title="Status information"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="model_verification.html" class="btn btn-neutral float-right" title="Software model, simulation and verification">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright &copy; 2022 <a href="https://www.magmio.com/contact">Magmio a.s.</a></p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="status_channel.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="model_verification.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
